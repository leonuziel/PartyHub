{
  "metadata": {
    "gameId": "quizclash",
    "title": "QuizClash (Config)",
    "description": "A dynamically configured trivia game.",
    "minPlayers": 1,
    "maxPlayers": 8
  },
  "gameData": {
    "questions": [
      {
        "questionText": "What is the chemical symbol for gold?",
        "correctAnswer": "Au",
        "options": [
          "Au",
          "Ag",
          "Go",
          "Gd"
        ]
      },
      {
        "questionText": "Which planet is known as the Red Planet?",
        "correctAnswer": "Mars",
        "options": [
          "Mars",
          "Jupiter",
          "Venus",
          "Saturn"
        ]
      }
    ]
  },
  "initialGameState": {
    "currentQuestionIndex": -1,
    "currentQuestion": null,
    "winner": null,
    "topThreePlayers": []
  },
  "playerAttributes": {
    "score": 0,
    "currentAnswer": null
  },
  "actions": {
    "goToNextQuestion": [
      {
        "function": "incrementProperty",
        "args": [
          "currentQuestionIndex"
        ]
      },
      {
        "function": "setProperty",
        "args": [
          "currentQuestion",
          "{{gameData.questions[gameState.currentQuestionIndex]}}"
        ]
      }
    ],
    "recordPlayerAnswer": [
      {
        "function": "setProperty",
        "args": [
          "playerAttributes.{{actorId}}.currentAnswer",
          "{{gameState.currentQuestion.options[payload]}}"
        ]
      }
    ],
    "awardPointsAndResetAnswer": [
      {
        "condition": "{{player.currentAnswer === gameState.currentQuestion.correctAnswer}}",
        "function": "incrementProperty",
        "args": [
          "playerAttributes.{{player.id}}.score",
          10
        ]
      },
      {
        "function": "setProperty",
        "args": [
          "playerAttributes.{{player.id}}.currentAnswer",
          null
        ]
      }
    ],
    "calculateWinner": [
      {
        "function": "calculateWinner"
      }
    ]
  },
  "initialState": "STARTING",
  "states": {
    "STARTING": {
      "onEnter": [
        {
          "function": "startTimer",
          "args": [
            3
          ]
        }
      ]
    },
    "ASKING_QUESTION": {
      "onEnter": [
        {
          "runAction": "goToNextQuestion"
        },
        {
          "function": "startTimer",
          "args": [
            10
          ]
        }
      ]
    },
    "REVEAL_ANSWER": {
      "onEnter": [
        {
          "function": "startTimer",
          "args": [
            5
          ]
        },
        {
          "forEachPlayer": {
            "effects": [
              {
                "runAction": "awardPointsAndResetAnswer"
              }
            ]
          }
        }
      ]
    },
    "FINISHED": {
      "onEnter": [
        {
          "runAction": "calculateWinner"
        }
      ]
    }
  },
  "events": {
    "startGame": {
      "permissions": [
        "host"
      ]
    },
    "submitAnswer": {
      "permissions": [
        "player"
      ],
      "effects": [
        {
          "runAction": "recordPlayerAnswer"
        }
      ]
    },
    "timerExpires": {
      "permissions": [
        "server"
      ]
    }
  },
  "transitions": [
    {
      "from": "STARTING",
      "to": "ASKING_QUESTION",
      "event": "timerExpires"
    },
    {
      "from": "ASKING_QUESTION",
      "to": "REVEAL_ANSWER",
      "event": "timerExpires"
    },
    {
      "from": "REVEAL_ANSWER",
      "to": "ASKING_QUESTION",
      "event": "timerExpires",
      "condition": "{{gameState.currentQuestionIndex < gameData.questions.length - 1}}"
    },
    {
      "from": "REVEAL_ANSWER",
      "to": "FINISHED",
      "event": "timerExpires",
      "condition": "{{gameState.currentQuestionIndex >= gameData.questions.length - 1}}"
    }
  ],
  "ui": {
    "STARTING": {
      "host": {
        "components": [
          {
            "component": "GameTitle",
            "props": {
              "title": "QuizClash"
            }
          },
          {
            "component": "CenteredMessage",
            "props": {
              "children": "Getting ready to start..."
            }
          },
          {
            "component": "CountdownTimer",
            "props": {
              "initialValue": 3
            }
          }
        ]
      },
      "player": {
        "components": [
          {
            "component": "CenteredMessage",
            "props": {
              "children": "The game is about to begin!"
            }
          }
        ]
      }
    },
    "ASKING_QUESTION": {
      "host": {
        "components": [
          {
            "component": "QuestionHeader",
            "props": {
              "text": "Question {{gameState.currentQuestionIndex + 1}}"
            }
          },
          {
            "component": "QuestionDisplay",
            "props": {
              "question": "{{gameState.currentQuestion.questionText}}"
            }
          },
          {
            "component": "PlayerStatusGrid",
            "props": {
              "players": "{{players}}"
            }
          }
        ]
      },
      "player": [
        {
          "condition": "{{player.currentAnswer !== null}}",
          "components": [
            {
              "component": "CenteredMessage",
              "props": {
                "children": "You have answered. Waiting for other players..."
              }
            }
          ]
        },
        {
          "components": [
            {
              "component": "QuestionDisplay",
              "props": {
                "question": "{{gameState.currentQuestion.questionText}}"
              }
            },
            {
              "component": "AnswerGrid",
              "props": {
                "answers": "{{gameState.currentQuestion.options}}",
                "onAnswer": {
                  "action": "submitAnswer"
                }
              }
            }
          ]
        }
      ]
    },
    "REVEAL_ANSWER": {
      "host": {
        "components": [
          {
            "component": "QuestionDisplay",
            "props": {
              "question": "{{gameState.currentQuestion.questionText}}"
            }
          },
          {
            "component": "AnswerResult",
            "props": {
              "answer": "{{gameState.currentQuestion.correctAnswer}}",
              "percentage": 100,
              "isCorrect": true
            }
          },
          {
            "component": "Leaderboard",
            "props": {
              "players": "{{players}}"
            }
          }
        ]
      },
      "player": {
        "components": [
          {
            "component": "AnswerResult",
            "props": {
              "answer": "{{player.currentAnswer}}",
              "percentage": 0,
              "isCorrect": "{{player.currentAnswer === gameState.currentQuestion.correctAnswer}}"
            }
          },
          {
            "component": "RankUpdate",
            "props": {
              "newRank": "{{player.rank}}"
            }
          }
        ]
      }
    },
    "FINISHED": {
      "host": {
        "components": [
          {
            "component": "WinnerDisplay",
            "props": {
              "winnerName": "{{gameState.winner.nickname}}"
            }
          },
          {
            "component": "Podium",
            "props": {
              "players": "{{gameState.topThreePlayers}}"
            }
          }
        ]
      },
      "player": {
        "components": [
          {
            "component": "RankDisplay",
            "props": {
              "rank": "{{player.rank}}"
            }
          }
        ]
      }
    }
  }
}
